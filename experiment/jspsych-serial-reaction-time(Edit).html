<!DOCTYPE html>
<html>

<head>
  <script src="js/jquery.min.js"></script>
  <script src="../jspsych.js"></script>
  <script src="../plugins/jspsych-serial-reaction-time.js"></script>
  <script src="../plugins/jspsych-text.js"></script>
  <link rel="stylesheet" href="../css/jspsych.css"></link>
</head>

<script>

var welcome_block = {
	type: "text",
	text: "Welcome to the experiment. Press any key to begin."
}

var instructions_general = {
	type: 'text',
	text: "<p>In this experiment, you will be presented with a grid of squares, " + 
	"where each square is mapped to a corresponding key on your keyboard.</p>" +
	jsPsych.plugins['serial-reaction-time'].stimulus([[1,1,1,1]], 80, [0,1], '#f00', [['3', '5','7','9']]) +
	"<p>Press the correct key when the corresponding square flashes on the monitor as quickly as you can.</p>" +
	"<p>Your accuracy and response times will be recorded and presented after each trial.</p>" +
	"<p>The experiment will begin with a short practice session to get you familiar with the format.</p>" +
	"<p>Press any key to begin." 
}

var instructions_practice = {
	type: 'text',
	text: "<p><b>Practice Test:</b></p>" +
	"<p>Press the following keys when the corresponding box flashes:</p>" +
	jsPsych.plugins['serial-reaction-time'].stimulus([[1,1,1,1]], 80, [0,2], '', [['3', '5','7','9']]) +
	"<p>Press any key to begin."
}



var practice_grid = 

	{
		Gridtype: [[1,1,0,1,1]],
		target: [[0,0],[0,1],[0,3],[0,4]], 
		choices: [['3','5', ,'7','9']],
		boxes: 4
	}

  
  var grids = [
	  
 	  {  
		Gridtype: 
		[[1,1,0,1,1], 
		[1,1,0,1,1]],
		target: [[0,0],[0,1],[0,3],[0,4],[1,0],[1,1],[1,3],[1,4]], 
		choices: [['w','e','','i','o'],
				  ['s','d','','k','l']],
		boxes: 8	
	  },
	  { 
	    Gridtype: 
	   [[1,1,1,0,1,1,1],
	   [1,1,1,0,1,1,1]],
		target: [[0,0],[0,1],[0,2],[0,4],[0,5],[0,6],[1,0],[1,1], [1,2], [1,4], [1,5], [1,6]], 
        choices: [['w','e','r','', 'u', 'i','o'],
				  ['s','d','f','','j','k','l']],
		boxes: 12	
		
	  },
	  {
	    Gridtype:
	  [[1,1,1,1,0,1,1,1,1],
	  [1,1,1,1,0,1,1,1,1]],	
		target: [[0,0],[0,1],[0,2],[0,3],[0,5],[0,6],[0,7],[0,8],[1,0],[1,1], [1,2], [1,3], [1,5], [1,6],[1,7],[1,8]], 
        choices: [['q','w','e','r','', 'y','u','i','o'],
				  ['a','s','d','f','','h','j','k','l']],
		boxes: 16
	  },
  ];
  
  var colorlist = [  
	  '#f3c300', 
	  '#875692', 
	  '#f38400', 
	  '#a1caf1', 
	  '#be0032', 
	  '#c2b280', 
	  '#848482', 
	  '#008856', 
	  '#e68fac', 
	  '#0067a5',
	  '#F99379', 
	  '#604E97',
	  '#F6A600', 
	  '#B3446C',
	  '#882D17',
	  '#8DB600',
  ]
  
  var which_grid = jsPsych.randomization.sample(grids, 1, false)[0];
  
  var locations = jsPsych.randomization.shuffle(which_grid.target);
  
  var t_variables = [];
  while(locations.length != 0){
  	t_variables.push({
  		target1: locations.pop(),
		target2: locations.pop()
  	});
  }
  
  
  var which_colors = colorlist.slice(0,which_grid.boxes);
  which_colors = jsPsych.randomization.shuffle(which_colors);
  
  
  
  var color_grid = [];
  for(var i=0; i<which_grid.Gridtype.length; i++){
	  color_grid.push([]);
	  for(var j=0; j<which_grid.Gridtype[i].length; j++){
		  if(which_grid.Gridtype[i][j] == 1){
			  color_grid[i].push(which_colors.pop());	
		  } else {
			  color_grid[i].push("");
		  }
	  }
  };
  
  
  var practice_timeline = {
	  
	  timeline: [
		  {
	  type: 'serial-reaction-time',
	  target: function(){ return jsPsych.timelineVariable('target'); },
	  grid_square_size: 80,
	  grid: practice_grid.Gridtype,
	  choices: practice_grid.choices,
			  boxcolor: [[colorlist[0],colorlist[1], ,colorlist[2],colorlist[3]]],
			  data: {'srt_type': 'practice'}
		  }
	  ],
	  timeline_variables: [
		  {target: practice_grid.target[0]},
		  {target: practice_grid.target[1]},
		  {target: practice_grid.target[2]},
		  {target: practice_grid.target[3]}
	  ],
    randomize_order: true,
	  repetitions: 3
  };
  
  var practice_debrief = { 
	  type: 'text',
	  text: function()
	  {
		  var data = jsPsych.data.getData([{'srt_type': 'practice'}]);
		  var sum_rt = 0;
		  var correct_trial_count = 0;
		  var correct_rt_count = 0;
		  for (var i = 0; i < data.length; i++) {
			  if (data[i].correct == true) {
     			 correct_trial_count++;
      		   	if(data[i].rt > -1) {
        		   sum_rt += data[i].rt;
       				correct_rt_count++;
      		  }
    	  	}
		}
		
	var rt = Math.floor(sum_rt / correct_rt_count)
    var accuracy = Math.floor(correct_trial_count / data.length * 100)

	return "<p>You responded correctly on <strong> "+accuracy+"% </strong> of "+
	        "the trials.</p><p>Your average response time was <strong>" +
	        rt + " ms</strong>. </p>" +
			"Press any key to continue.</p>"
		  
  }
  
}

var instructions_test = {
	type: 'text',
	text: "<p><b> Testing Phase:</b><p>" +
	"<p>The next phase of the experiment will consistent of 4 sessions</p>" + 
	"<p>where a grid of boxes are mapped to the following keys: </p>" +
	jsPsych.plugins['serial-reaction-time'].stimulus(which_grid.Gridtype, 80, [0,0],'', which_grid.choices) +
	"<p>Each session will take approximately 10-20 minutes, and a break will be provided in between each session.</p>" +
	"<p>Press any key to begin.</p>"
	
	
}

function repetition_selection(g) { 
	if(g == [[1,1,0,1,1], [1,1,0,1,1]]) {
		return 40;}
		else if (g == [[1,1,1,0,1,1,1], [1,1,1,0,1,1,1]]) {
			return 30;}
			else {return 20;}
				
		}			
		
	

  var test_timeline_1 = {
    
    timeline: [
      {
        type: 'serial-reaction-time',
        target: function(){ return jsPsych.timelineVariable('target1'); },
		  grid_square_size: 80,
		  grid: which_grid.Gridtype,
		  choices: which_grid.choices,
		  data: {'srt_type': 'target'},
		  boxcolor: color_grid
      },
      {
        type: 'serial-reaction-time',
        target: function(){ return jsPsych.timelineVariable('target2'); },
		  grid_square_size: 80,
		  grid: which_grid.Gridtype,
		  choices: which_grid.choices,
		  data: {'srt_type': 'target'},
		  boxcolor: color_grid
      }
    ],
    timeline_variables: t_variables,
    randomize_order: true,
    repetitions: repetition_selection(which_grid.Gridtype)
	
	
    };
	
    var test_1_debrief = { 
  	  type: 'text',
  	  text: function()
  	  {
  		  var data = jsPsych.data.getData([{'srt_type': 'target'}]);
  		  var sum_rt = 0;
  		  var correct_trial_count = 0;
  		  var correct_rt_count = 0;
  		  for (var i = 0; i < data.length; i++) {
  			  if (data[i].correct == true) {
       			 correct_trial_count++;
        		   	if(data[i].rt > -1) {
          		   sum_rt += data[i].rt;
         				correct_rt_count++;
        		  }
      	  	}
  		}
		
  	var rt = Math.floor(sum_rt / correct_rt_count)
      var accuracy = Math.floor(correct_trial_count / data.length * 100)

  	return "<p>You responded correctly on <strong> "+accuracy+"% </strong> of "+
  	        "the trials.</p><p>Your average response time was <strong>" +
  	        rt + " ms</strong>. </p>" +
  			"Press any key to continue.</p>"
		  
    }
  
  }
  
  var test_timeline_2 = {
    
    timeline: [
      {
        type: 'serial-reaction-time',
        target: function(){ return jsPsych.timelineVariable('target1'); },
		  grid_square_size: 80,
		  grid: which_grid.Gridtype,
		  choices: which_grid.choices,
		  boxcolor: color_grid
      },
      {
        type: 'serial-reaction-time',
        target: function(){ return jsPsych.timelineVariable('target2'); },
		  grid_square_size: 80,
		  grid: which_grid.Gridtype,
		  choices: which_grid.choices,
		  boxcolor: color_grid
      }
    ],
    timeline_variables: t_variables,
    randomize_order: true,
    repetitions: repetition_selection(which_grid.Gridtype)
  };
  
  var test_2_debrief = { 
	  type: 'text',
	  text: function()
	  {
		  var data = jsPsych.data.getData([{'srt_type': 'target'}]);
		  var sum_rt = 0;
		  var correct_trial_count = 0;
		  var correct_rt_count = 0;
		  for (var i = 0; i < data.length; i++) {
			  if (data[i].correct == true) {
     			 correct_trial_count++;
      		   	if(data[i].rt > -1) {
        		   sum_rt += data[i].rt;
       				correct_rt_count++;
      		  }
    	  	}
		}
	
	var rt = Math.floor(sum_rt / correct_rt_count)
    var accuracy = Math.floor(correct_trial_count / data.length * 100)

	return "<p>You responded correctly on <strong> "+accuracy+"% </strong> of "+
	        "the trials.</p><p>Your average response time was <strong>" +
	        rt + " ms</strong>. </p>" +
			"Press any key to continue.</p>"
	  
  }

}
  
  var test_timeline_3 = {
    
    timeline: [
      {
        type: 'serial-reaction-time',
        target: function(){ return jsPsych.timelineVariable('target1'); },
		  grid_square_size: 80,
		  grid: which_grid.Gridtype,
		  choices: which_grid.choices,
		  boxcolor: color_grid
      },
      {
        type: 'serial-reaction-time',
        target: function(){ return jsPsych.timelineVariable('target2'); },
		  grid_square_size: 80,
		  grid: which_grid.Gridtype,
		  choices: which_grid.choices,
		  boxcolor: color_grid
      }
    ],
    timeline_variables: t_variables,
    randomize_order: true,
    repetitions: repetition_selection(which_grid.Gridtype)
  };
  
  var test_3_debrief = { 
	  type: 'text',
	  text: function()
	  {
		  var data = jsPsych.data.getData([{'srt_type': 'target'}]);
		  var sum_rt = 0;
		  var correct_trial_count = 0;
		  var correct_rt_count = 0;
		  for (var i = 0; i < data.length; i++) {
			  if (data[i].correct == true) {
     			 correct_trial_count++;
      		   	if(data[i].rt > -1) {
        		   sum_rt += data[i].rt;
       				correct_rt_count++;
      		  }
    	  	}
		}
	
	var rt = Math.floor(sum_rt / correct_rt_count)
    var accuracy = Math.floor(correct_trial_count / data.length * 100)

	return "<p>You responded correctly on <strong> "+accuracy+"% </strong> of "+
	        "the trials.</p><p>Your average response time was <strong>" +
	        rt + " ms</strong>. </p>" +
			"Press any key to continue.</p>"
	  
  }

}
  
  var test_timeline_4 = {
    
    timeline: [
      {
        type: 'serial-reaction-time',
        target: function(){ return jsPsych.timelineVariable('target1'); },
		  grid_square_size: 80,
		  grid: which_grid.Gridtype,
		  choices: which_grid.choices,
		  boxcolor: color_grid
      },
      {
        type: 'serial-reaction-time',
        target: function(){ return jsPsych.timelineVariable('target2'); },
		  grid_square_size: 80,
		  grid: which_grid.Gridtype,
		  choices: which_grid.choices,
		  boxcolor: color_grid
      }
    ],
    timeline_variables: t_variables,
    randomize_order: true,
    repetitions: repetition_selection(which_grid.Gridtype)
  }
  
  var test_4_debrief = { 
	  type: 'text',
	  text: function()
	  {
		  var data = jsPsych.data.getData([{'srt_type': 'target'}]);
		  var sum_rt = 0;
		  var correct_trial_count = 0;
		  var correct_rt_count = 0;
		  for (var i = 0; i < data.length; i++) {
			  if (data[i].correct == true) {
     			 correct_trial_count++;
      		   	if(data[i].rt > -1) {
        		   sum_rt += data[i].rt;
       				correct_rt_count++;
      		  }
    	  	}
		}
	
	var rt = Math.floor(sum_rt / correct_rt_count)
    var accuracy = Math.floor(correct_trial_count / data.length * 100)

	return "<p>You responded correctly on <strong> "+accuracy+"% </strong> of "+
	        "the trials.</p><p>Your average response time was <strong>" +
	        rt + " ms</strong>. </p>" +
			"Press any key to continue.</p>"
	  
  }

}

var Final_debrief = {
	type:'text',
	text: "<p>The experiment is now complete. Thank you for participating!</p>"
}



  
  
  
  var timeline = [];
  
  timeline.push(welcome_block);
  timeline.push(instructions_general);
  timeline.push(instructions_practice);
  timeline.push(practice_timeline); 
  timeline.push(practice_debrief);
  timeline.push(instructions_test);
  timeline.push(test_timeline_1);
  timeline.push(test_1_debrief);
  timeline.push(test_timeline_2);
  timeline.push(test_2_debrief);
  timeline.push(test_timeline_3);
  timeline.push(test_3_debrief);
  timeline.push(test_timeline_4);
  timeline.push(test_4_debrief);
  timeline.push(Final_debrief)


  jsPsych.init({
    timeline: timeline,
    on_finish: function() {
      jsPsych.data.displayData();
  },
    default_iti: 0
  });
</script>

</html>
